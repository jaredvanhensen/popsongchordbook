<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Scrolling Chords</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 110'><defs><linearGradient id='ps' x1='0' y1='0' x2='0' y2='1'><stop offset='0' stop-color='%2394a3b8'/><stop offset='1' stop-color='%23475569'/></linearGradient><linearGradient id='pf' x1='0' y1='0' x2='0' y2='1'><stop offset='0' stop-color='white'/><stop offset='1' stop-color='%23f1f5f9'/></linearGradient><radialGradient id='ng' cx='50' cy='50' r='50'><stop offset='0' stop-color='%23a855f7'/><stop offset='1' stop-color='%236b21a8'/></radialGradient></defs><g transform='translate(5,5)'><rect y='10' width='150' height='90' rx='20' fill='url(%23ps)'/><rect width='150' height='90' rx='20' fill='url(%23pf)' stroke='%23e2e8f0'/><line x1='30' y1='50' x2='120' y2='50' stroke='%23cbd5e1' stroke-width='6' stroke-linecap='round'/><circle cx='75' cy='50' r='20' fill='url(%23ng)'/></g></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="scrolling.css?v=2.010">
</head>

<div class="header-metadata">
    <h1 id="artistDisplay" class="artist-display"></h1>
    <h2 id="songTitleDisplay" class="song-title-display"></h2>
</div>

<div class="controls-container">
    <a href="index.html" id="backBtn" title="Back to Library">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        <span>Back</span>
    </a>

    <label for="midiInput" class="custom-file-btn" title="Upload MIDI or JSON file">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        <span>Open File</span>
    </label>
    <input type="file" id="midiInput" accept=".mid,.midi,audio/midi,.json,application/json" class="file-input"
        style="display: none;">

    <div class="playback-controls">
        <button id="restartBtn" title="Restart from beginning">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polygon points="19 20 9 12 19 4 19 20"></polygon>
                <line x1="5" y1="19" x2="5" y2="5"></line>
            </svg>
        </button>
        <button id="rwdBtn" title="Rewind 10s">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polygon points="11 19 2 12 11 5 11 19"></polygon>
                <polygon points="22 19 13 12 22 5 22 19"></polygon>
            </svg>
        </button>
        <button id="playPauseBtn" disabled>
            <svg id="playIcon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Play</span>
        </button>
        <button id="fwdBtn" title="Forward 10s">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polygon points="13 19 22 12 13 5 13 19"></polygon>
                <polygon points="2 19 11 12 2 5 2 19"></polygon>
            </svg>
        </button>

        <div style="width: 1px; height: 24px; background: #e2e8f0; margin: 0 4px;"></div>

        <button id="zoomOutBtn" title="Zoom Out Timeline">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                <line x1="8" y1="11" x2="14" y2="11"></line>
            </svg>
        </button>
        <button id="zoomInBtn" title="Zoom In Timeline">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                <line x1="11" y1="8" x2="11" y2="14"></line>
                <line x1="8" y1="11" x2="14" y2="11"></line>
            </svg>
        </button>

        <div style="width: 1px; height: 24px; background: #e2e8f0; margin: 0 4px;"></div>

        <button id="exportBtn" disabled title="Download chords as JSON">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span>Export</span>
        </button>
        <button id="saveBtn" class="hidden" disabled title="Save chords directly to song database">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            <span>Save</span>
        </button>
        <button id="clearDataBtn" disabled title="Remove all JSON chord data">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
            <span>Clear</span>
        </button>

        <div style="width: 1px; height: 24px; background: #e2e8f0; margin: 0 4px;"></div>

        <!-- Selection Tools -->
        <button id="selectModeBtn" title="Toggle Selection Mode">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 12h-5l-1 5-2-5 2-5 1 5h5"></path>
                <circle cx="12" cy="12" r="10"></circle>
            </svg>
            <span>Select</span>
        </button>
        <button id="duplicateBtn" class="hidden" title="Duplicate Selected Chords">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            <span>Copy</span>
        </button>
        <button id="deleteSelectedBtn" class="hidden" title="Delete Selected Chords">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            <span>Del</span>
        </button>

        <div style="width: 1px; height: 24px; background: #e2e8f0; margin: 0 4px;"></div>

        <button id="metronomeBtn" title="Toggle Metronome Click" class="metronome-btn">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L7 22h10L12 2z"></path>
                <circle cx="12" cy="18" r="2"></circle>
                <path d="M12 14l3-9"></path>
            </svg>
        </button>
        <button id="bpmBtn" title="Set Bits Per Minute">120 BPM</button>
        <button id="captureBtn" title="Record timing" class="capture-btn hidden">
            <circle cx="12" cy="12" r="6" fill="#ef4444"></circle>
            <span>Capture</span>
        </button>
        <button id="audioToggleBtn" title="Toggle Chord Audio" class="audio-btn">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
        </button>
        <button id="speedBtn" title="Toggle Playback Speed">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>1.0x</span>
        </button>
    </div>
    <div id="statusText">Upload a MIDI file to start</div>
</div>


<!-- New Chord Toolbar -->
<div id="chordButtonsContainer" class="chord-buttons-container hidden"></div>

<div class="timeline-container" id="timeline">
    <div class="playhead"></div>

    <!-- Current Sticky Chord -->
    <div id="currentChordDisplay" class="current-chord-display"></div>

    <div class="instructions" id="instructions">Drop MIDI file here</div>
    <!-- Markers (bars/time) -->
    <div class="marker-track" id="markerTrack"></div>
    <!-- Chords -->
    <div class="chord-track" id="chordTrack"></div>

</div>

<div id="youtubePlayerContainer" class="youtube-player-container hidden">
    <button id="closeYoutubeBtn" title="Close Video">Ã—</button>
    <div id="youtubePlayer"></div>
</div>

<!-- Count-in Overlay -->
<div id="countInOverlay" class="count-in-overlay hidden">
    <div id="countInNumber"></div>
    <div class="count-in-label">Get Ready!</div>
</div>

<!-- Recording Indicator -->
<div id="recordingIndicator" class="recording-indicator hidden">
    ðŸ”´ RECORDING
</div>
</div>

<!-- Midi Parsing Library -->
<script src="https://unpkg.com/@tonejs/midi"></script>

<!-- Utils -->
<script src="js/utils/PianoAudioPlayer.js?v=2.010"></script>
<script src="js/utils/ChordParser.js?v=2.010"></script>
<script src="js/ui/ConfirmationModal.js?v=2.010"></script>
<script src="js/ui/ChordEditModal.js?v=2.010"></script>
<script src="js/ui/BpmEditModal.js?v=2.010"></script>
<script src="js/scrolling_chords.js?v=2.010"></script>
</body>

</html>